---
title: "Experimental Design"
author: "Venukanan Subenthiran"
date: "2022-11-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Experimental Design

## Splitting the Data into Training and Test Sets

```{r}

#install.packages("caTools")
library(caTools)



set.seed(123)

TrainTestData <- sample.split(Y = fraudTotal.db$is_fraud, SplitRatio = 0.7)
FD_Train <- fraudTotal.db[TrainTestData,]
FD_Test <- fraudTotal.db[!TrainTestData,]

#converting dob to numeric
FD_Train$dob <- as.numeric(FD_Train$dob)
FD_Test$dob <- as.numeric(FD_Test$dob)


#convertig trans_date_trans_time to numeric
FD_Train$trans_date_trans_time <- as.numeric(as.POSIXct(FD_Train$trans_date_trans_time))
FD_Test$trans_date_trans_time <- as.numeric(as.POSIXct(FD_Test$trans_date_trans_time))



#If there is a need to convert back then need to figure out the way to do that.
###FD_Train$trans_date_trans_time <- strptime(FD_Train$trans_date_trans_time, format = "%Y%m%d %H:%M:%s")
###FD_Train_trial2 <- as.numeric(FD_Train$trans_date_trans_time)

###FD_Train$trans_date_trans_time <- as.POSIXct(format(FD_Train$trans_date_trans_time))
###as.Date.POSIXct(FD_Train$trans_date_trans_time, origin = "1970-01-01 00:00")



#This will convert dob back to date.
###FD_Train$dob <- as.Date(FD_Train$dob, origin = "1970-01-01")


```


## Treatment for Imbalance Data using ROSE
```{r}
#install.packages("ROSE")
library(ROSE)

table(FD_Train$is_fraud)

FD_ROSE <- ROSE(formula = is_fraud~.,data = FD_Train, seed = 345)

table(FD_ROSE$data$is_fraud)

FD_Train_ROSE <- FD_ROSE$data

Reduced_FD_Train_ROSE <- subset(FD_Train_ROSE, select = c(2, 5, 6, 10, 11, 13, 14, 18, 20, 22, 23))

```


## Cross Validation???
```{r}
#install.packages("caret")
library(caret)

#specify cross-validation method
control <- trainControl(method = "cv", number = 2)

#fit a regression model and use k-fold CD to evaluate performance
mod <- train(is_fraud ~., merch_long, data = Reduced_FD_Train_ROSE, method = "lm", trControl = control)

# Unable to run, due to limited RAM size on PC.
```



# Modeling

## Classification

### Decision Tree
```{r}
#install.packages("rpart.plot")
library(rpart.plot)

#Train with model
fit_tree <- rpart(is_fraud~., data = Reduced_FD_Train_ROSE, method = "class")
rpart.plot(fit_tree, extra = 110)

# Prediction
predict_tree <- predict(fit_tree, FD_Test, type = "class")



```
## Testing merging of categorical variables
```{r}

Reduced_FD_Train_ROSE2 <- subset(FD_Train_ROSE, select = c(2, 4, 5, 6, 10, 11, 13, 14, 18, 20, 22, 23))

Reduced_FD_Train_ROSE2$M_cat_merch <- transform(Reduced_FD_Train_ROSE2, newVar = paste(category, merchant))

Reduced_FD_Train_ROSE2$M_cat_merch <- as.factor(Reduced_FD_Train_ROSE2$M_cat_merch)
```




### Random Forest
```{r}
#install.packages("randomForest")
library(randomForest)

#Train with model
fit_RF <- randomForest(is_fraud~., data = Reduced_FD_Train_ROSE, importance = TRUE, proximity = TRUE)

#Prediction
predict_RF <- predict(fit_RF, FD_Test, type)

```


### K-Nearest Neighbours

## Regression

### Logistic Regression biraviate??

# Evaluation

## Confusion Matrix

### Decision Tree
```{r}
table(FD_Test$is_fraud, predict_tree)

```


### Random Forest

### K-Nearest Neighbours

### Logistic Regression

## Accuracy, Recall, and Precision